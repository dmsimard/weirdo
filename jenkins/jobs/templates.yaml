- job-template:
    name: 'weirdo-gate-ansible-{playbook}'
    defaults: 'weirdo-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job gates against commits done to <a href="https://github.com/redhat-openstack/weirdo" target="_blank">WeIRDO</a>.</p>
        <p>It runs the playbook <a href="https://github.com/redhat-openstack/weirdo/blob/master/playbooks/{playbook}.yml" target="_blank">{playbook}.yml</a></p>
        <br>
        This is what this job runs:
        <pre>
        # Install WeIRDO from provided jenkins scm gerrit commit ref
        pip install -e weirdo
        pushd weirdo
        git log -n 5 --oneline
        python setup.py install
        popd

        # Need features from Ansible 2 which is not yet released
        pip install -e git+https://github.com/ansible/ansible.git@devel#egg=ansible
        ansible --version

        # Setup ansible config and run the playbook
        pushd $VIRTUAL_ENV/usr/local/share/weirdo
        mv ansible.cfg.example ansible.cfg
        mv hosts.example hosts
        ansible-playbook -vv -i hosts playbooks/{playbook}.yml
        result=$?

        exit $result
        </pre>

    triggers:
          - weirdo-gate-trigger
    scm:
        - weirdo-gate-repository
    builders:
        - weirdo-gate-ansible:
            playbook: '{playbook}'
    properties:
        - ownership:
            owner: dms@redhat.com
    publishers:
        - email-cores

- job-template:
    name: 'weirdo-gate-tox-{test}'
    defaults: 'weirdo-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job gates against commits done to <a href="https://github.com/redhat-openstack/weirdo" target="_blank">WeIRDO</a>.</p>
        <p>It leverages tox for testing.</p>
        <br>
        This is what this job runs:
        <pre>
        # Run {test} from provided jenkins scm gerrit commit ref
        pushd weirdo
        git log -n 5 --oneline
        tox -e {test}
        result=$?
        exit $result
        </pre>

    triggers:
          - weirdo-gate-trigger
    scm:
        - weirdo-gate-repository
    builders:
        - weirdo-gate-tox:
            test: '{test}'
    properties:
        - ownership:
            owner: dms@redhat.com
    publishers:
        - email-cores


- job-template:
    name: 'weirdo-periodic-{playbook}'
    defaults: 'weirdo-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job periodically runs <a href="https://github.com/redhat-openstack/weirdo" target="_blank">WeIRDO</a>.</p>
        <p>It runs the playbook <a href="https://github.com/redhat-openstack/weirdo/blob/master/playbooks/{playbook}.yml" target="_blank">{playbook}.yml</a></p>
        <br>
        This is what this job runs:
        <pre>
        # Install WeIRDO
        pip install -e git+https://github.com/redhat-openstack/weirdo.git@master#egg=weirdo
        pushd $VIRTUAL_ENV/src/weirdo
        git log -n 5 --oneline
        python setup.py install
        popd

        # Need features from Ansible 2 which is not yet released
        pip install -e git+https://github.com/ansible/ansible.git@devel#egg=ansible
        ansible --version

        # Setup ansible config and run the playbook
        pushd $VIRTUAL_ENV/usr/local/share/weirdo
        mv ansible.cfg.example ansible.cfg
        mv hosts.example hosts
        ansible-playbook -vv -i hosts playbooks/{playbook}.yml
        result=$?

        exit $result
        </pre>

    triggers:
          - weirdo-periodic-trigger
    builders:
        - weirdo-periodic-builder:
            playbook: '{playbook}'
    properties:
        - ownership:
            owner: dms@redhat.com
    publishers:
        - email-cores
