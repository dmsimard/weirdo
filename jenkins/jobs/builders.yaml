- builder:
    name: 'weirdo-gate-ansible'
    builders:
        - shining-panda:
            build-environment: 'virtualenv'
            python-version: 'system-CPython-2.7'
            nature: 'shell'
            clear: true
            use-distribute: false
            system-site-packages: false
            ignore-exit-code: false
            command: |
              # Install WeIRDO from provided jenkins scm gerrit commit ref
              pip install -e weirdo
              pushd weirdo
              git log -n 5 --oneline
              python setup.py install
              popd

              # Setup ansible config and run the playbook
              pushd $VIRTUAL_ENV/usr/local/share/weirdo
              mv ansible.cfg.example ansible.cfg
              ansible --version
              ansible-playbook -vv playbooks/{playbook}.yml --extra-vars openstack_release={openstack_release}
              result=$?

              exit $result

- builder:
    name: 'weirdo-gate-tox'
    builders:
        - shining-panda:
            build-environment: 'virtualenv'
            python-version: 'system-CPython-2.7'
            nature: 'shell'
            clear: true
            use-distribute: false
            system-site-packages: false
            ignore-exit-code: false
            command: |
              # Ensure tox is installed
              pip install tox

              # Run {test} from provided jenkins scm gerrit commit ref
              pushd weirdo
              git log -n 5 --oneline
              tox -e {test}
              result=$?
              exit $result

- builder:
    name: 'weirdo-periodic-builder'
    builders:
        - shining-panda:
            build-environment: 'virtualenv'
            python-version: 'system-CPython-2.7'
            nature: 'shell'
            clear: true
            use-distribute: false
            system-site-packages: false
            ignore-exit-code: false
            command: |
              # Install WeIRDO from master branch
              pip install -e git+https://github.com/redhat-openstack/weirdo.git@master#egg=weirdo
              pushd $VIRTUAL_ENV/src/weirdo
              git log -n 5 --oneline
              python setup.py install
              popd

              # Setup ansible config and run the playbook
              pushd $VIRTUAL_ENV/usr/local/share/weirdo
              mv ansible.cfg.example ansible.cfg
              ansible --version
              ansible-playbook -vv playbooks/{playbook}.yml --extra-vars openstack_release={openstack_release}
              result=$?

              exit $result

- builder:
    name: 'weirdo-promote-builder'
    builders:
        - shining-panda:
            build-environment: 'virtualenv'
            python-version: 'system-CPython-2.7'
            nature: 'shell'
            clear: true
            use-distribute: false
            system-site-packages: false
            ignore-exit-code: false
            command: |
              delorean_hash=${{delorean_current_hash:-current}}
              delorean_url="http://trunk.rdoproject.org/centos7-{openstack_release}/${{delorean_hash}}/delorean.repo"

              # Install WeIRDO
              pip install -e git+https://github.com/redhat-openstack/weirdo.git@master#egg=weirdo
              pushd $VIRTUAL_ENV/src/weirdo
              git log -n 5 --oneline
              python setup.py install
              popd

              # Setup ansible config and run the playbook
              pushd $VIRTUAL_ENV/usr/local/share/weirdo
              mv ansible.cfg.example ansible.cfg
              ansible --version
              ansible-playbook -vv playbooks/{playbook}.yml --extra-vars delorean_url="$delorean_url" --extra-vars openstack_release={openstack_release}
              result=$?

              exit $result

- builder:
    name: 'weirdo-generic-builder'
    builders:
        - shining-panda:
            build-environment: 'virtualenv'
            python-version: 'system-CPython-2.7'
            nature: 'shell'
            clear: true
            use-distribute: false
            system-site-packages: false
            ignore-exit-code: false
            command: |
              # Install WeIRDO
              pip install -e git+https://github.com/redhat-openstack/weirdo.git@master#egg=weirdo
              pushd $VIRTUAL_ENV/src/weirdo
              git log -n 5 --oneline
              python setup.py install
              popd

              # Setup ansible config and run the playbook
              pushd $VIRTUAL_ENV/usr/local/share/weirdo
              mv ansible.cfg.example ansible.cfg
              ansible --version
              ansible-playbook -vv playbooks/{playbook}.yml --extra-vars delorean_url="{delorean_url}" --extra-vars delorean_deps_url="{delorean_deps_url}"
              result=$?

              exit $result
